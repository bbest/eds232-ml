<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ben Best" />


<title>Lab 2a. Community - Cluster</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.19/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lab1a_sdm-explore.html">1a. Species: explore</a>
    </li>
    <li>
      <a href="lab1b_sdm-regress.html">1b. Species: regress</a>
    </li>
    <li>
      <a href="lab1c_sdm-trees.html">1c. Species: trees</a>
    </li>
    <li>
      <a href="lab1d_sdm-evaluate.html">1d. Species: evaluate</a>
    </li>
    <li>
      <a href="lab2a_community-cluster.html">2a. Community: cluster</a>
    </li>
    <li>
      <a href="lab2b_community-ordination.html">2b. Community: ordination</a>
    </li>
  </ul>
</li>
<li>
  <a href="glossary.html">Glosssary</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="https://github.com/bbest/eds232-ml">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 2a. Community - Cluster</h1>
<h4 class="author">Ben Best</h4>
<h4 class="date">1/18/2022</h4>

</div>


<div id="learning-objectives" class="section level1 unnumbered">
<h1 class="unnumbered">Learning Objectives</h1>
<p>In this lab, you will play with <strong>unsupervised classification</strong> techniques while working with <strong>ecological community</strong> datasets.</p>
<ul>
<li><p>Comparing species counts between sites using <strong>distance</strong> metrics:</p>
<ul>
<li><p><strong>Euclidean</strong> calculates the distance between a virtualized space using Pythagorean theorem.</p></li>
<li><p><strong>Manhattan</strong> calculates integer “around the block” difference.</p></li>
<li><p><strong>Bray-Curtis</strong> dissimilarity is based on the sum of lowest counts of shared species between sites over the sum of all species. A dissimilarity value of 1 is completely dissimilar, i.e. no species shared. A value of 0 is completely identical.</p></li>
</ul></li>
<li><p><strong>Clustering</strong></p>
<ul>
<li><p><strong><em>K</em>-Means clustering</strong> with function <code>kmeans()</code> given a pre-assigned number of clusters assigns membership centroid based on reducing within cluster variation.</p>
<ul>
<li><strong>Voronoi diagrams</strong> visualizes regions to nearest points, useful here to show membership of nodes to nearest centroid.</li>
</ul></li>
<li><p><strong>Hierarchical clustering</strong> allows for a non-specific number of clusters.</p>
<ul>
<li><p><strong>Agglomerative hierarchical clustering</strong>, such as with <code>diana()</code>, agglomerates as it builds the tree. It is good at identifying small clusters.</p></li>
<li><p><strong>Divisive hierarchical clustering</strong>, such as with <code>agnes()</code>, divides as it builds the tree. It is good at identifying large clusters.</p></li>
<li><p><strong>Dendrograms</strong> visualize the branching tree.</p></li>
</ul></li>
</ul></li>
<li><p><strong>Ordination</strong> (coming Monday)</p></li>
</ul>
</div>
<div id="clustering" class="section level1">
<h1>Clustering</h1>
<p><strong>Clustering</strong> associates similar data points with each other, adding a grouping label. It is a form of <strong>unsupervised learning</strong> since we don’t fit the model based on feeding it a labeled response (i.e. <span class="math inline">\(y\)</span>).</p>
<div id="k-means-clustering" class="section level2">
<h2><em>K</em>-Means Clustering</h2>
<p>Source: <a href="https://datascienceplus.com/k-means-clustering-in-r/">K Means Clustering in R | DataScience+</a></p>
<p>In <em>k</em>-means clustering, the number of clusters needs to be specified. The algorithm randomly assigns each observation to a cluster, and finds the centroid of each cluster. Then, the algorithm iterates through two steps:</p>
<ol style="list-style-type: decimal">
<li>Reassign data points to the cluster whose centroid is closest.</li>
<li>Calculate new centroid of each cluster.</li>
</ol>
<p>These two steps are repeated until the within cluster variation cannot be reduced any further. The within cluster variation is calculated as the sum of the euclidean distance between the data points and their respective cluster centroids.</p>
<div id="load-and-plot-the-iris-dataset" class="section level3">
<h3>Load and plot the <code>iris</code> dataset</h3>
<pre class="r"><code># load R packages
librarian::shelf(
  dplyr, DT, ggplot2, tibble)</code></pre>
<pre><code>## 
##   The &#39;cran_repo&#39; argument in shelf() was not set, so it will use
##   cran_repo = &#39;https://cran.r-project.org&#39; by default.
## 
##   To avoid this message, set the &#39;cran_repo&#39; argument to a CRAN
##   mirror URL (see https://cran.r-project.org/mirrors.html) or set
##   &#39;quiet = TRUE&#39;.</code></pre>
<pre class="r"><code># set seed for reproducible results
set.seed(42)

# load the dataset
data(&quot;iris&quot;)

# look at documentation in RStudio
if (interactive())
  help(iris)

# show data table
datatable(iris)</code></pre>
<div id="htmlwidget-9ae0f687cf42793a647d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9ae0f687cf42793a647d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150"],[5.1,4.9,4.7,4.6,5,5.4,4.6,5,4.4,4.9,5.4,4.8,4.8,4.3,5.8,5.7,5.4,5.1,5.7,5.1,5.4,5.1,4.6,5.1,4.8,5,5,5.2,5.2,4.7,4.8,5.4,5.2,5.5,4.9,5,5.5,4.9,4.4,5.1,5,4.5,4.4,5,5.1,4.8,5.1,4.6,5.3,5,7,6.4,6.9,5.5,6.5,5.7,6.3,4.9,6.6,5.2,5,5.9,6,6.1,5.6,6.7,5.6,5.8,6.2,5.6,5.9,6.1,6.3,6.1,6.4,6.6,6.8,6.7,6,5.7,5.5,5.5,5.8,6,5.4,6,6.7,6.3,5.6,5.5,5.5,6.1,5.8,5,5.6,5.7,5.7,6.2,5.1,5.7,6.3,5.8,7.1,6.3,6.5,7.6,4.9,7.3,6.7,7.2,6.5,6.4,6.8,5.7,5.8,6.4,6.5,7.7,7.7,6,6.9,5.6,7.7,6.3,6.7,7.2,6.2,6.1,6.4,7.2,7.4,7.9,6.4,6.3,6.1,7.7,6.3,6.4,6,6.9,6.7,6.9,5.8,6.8,6.7,6.7,6.3,6.5,6.2,5.9],[3.5,3,3.2,3.1,3.6,3.9,3.4,3.4,2.9,3.1,3.7,3.4,3,3,4,4.4,3.9,3.5,3.8,3.8,3.4,3.7,3.6,3.3,3.4,3,3.4,3.5,3.4,3.2,3.1,3.4,4.1,4.2,3.1,3.2,3.5,3.6,3,3.4,3.5,2.3,3.2,3.5,3.8,3,3.8,3.2,3.7,3.3,3.2,3.2,3.1,2.3,2.8,2.8,3.3,2.4,2.9,2.7,2,3,2.2,2.9,2.9,3.1,3,2.7,2.2,2.5,3.2,2.8,2.5,2.8,2.9,3,2.8,3,2.9,2.6,2.4,2.4,2.7,2.7,3,3.4,3.1,2.3,3,2.5,2.6,3,2.6,2.3,2.7,3,2.9,2.9,2.5,2.8,3.3,2.7,3,2.9,3,3,2.5,2.9,2.5,3.6,3.2,2.7,3,2.5,2.8,3.2,3,3.8,2.6,2.2,3.2,2.8,2.8,2.7,3.3,3.2,2.8,3,2.8,3,2.8,3.8,2.8,2.8,2.6,3,3.4,3.1,3,3.1,3.1,3.1,2.7,3.2,3.3,3,2.5,3,3.4,3],[1.4,1.4,1.3,1.5,1.4,1.7,1.4,1.5,1.4,1.5,1.5,1.6,1.4,1.1,1.2,1.5,1.3,1.4,1.7,1.5,1.7,1.5,1,1.7,1.9,1.6,1.6,1.5,1.4,1.6,1.6,1.5,1.5,1.4,1.5,1.2,1.3,1.4,1.3,1.5,1.3,1.3,1.3,1.6,1.9,1.4,1.6,1.4,1.5,1.4,4.7,4.5,4.9,4,4.6,4.5,4.7,3.3,4.6,3.9,3.5,4.2,4,4.7,3.6,4.4,4.5,4.1,4.5,3.9,4.8,4,4.9,4.7,4.3,4.4,4.8,5,4.5,3.5,3.8,3.7,3.9,5.1,4.5,4.5,4.7,4.4,4.1,4,4.4,4.6,4,3.3,4.2,4.2,4.2,4.3,3,4.1,6,5.1,5.9,5.6,5.8,6.6,4.5,6.3,5.8,6.1,5.1,5.3,5.5,5,5.1,5.3,5.5,6.7,6.9,5,5.7,4.9,6.7,4.9,5.7,6,4.8,4.9,5.6,5.8,6.1,6.4,5.6,5.1,5.6,6.1,5.6,5.5,4.8,5.4,5.6,5.1,5.1,5.9,5.7,5.2,5,5.2,5.4,5.1],[0.2,0.2,0.2,0.2,0.2,0.4,0.3,0.2,0.2,0.1,0.2,0.2,0.1,0.1,0.2,0.4,0.4,0.3,0.3,0.3,0.2,0.4,0.2,0.5,0.2,0.2,0.4,0.2,0.2,0.2,0.2,0.4,0.1,0.2,0.2,0.2,0.2,0.1,0.2,0.2,0.3,0.3,0.2,0.6,0.4,0.3,0.2,0.2,0.2,0.2,1.4,1.5,1.5,1.3,1.5,1.3,1.6,1,1.3,1.4,1,1.5,1,1.4,1.3,1.4,1.5,1,1.5,1.1,1.8,1.3,1.5,1.2,1.3,1.4,1.4,1.7,1.5,1,1.1,1,1.2,1.6,1.5,1.6,1.5,1.3,1.3,1.3,1.2,1.4,1.2,1,1.3,1.2,1.3,1.3,1.1,1.3,2.5,1.9,2.1,1.8,2.2,2.1,1.7,1.8,1.8,2.5,2,1.9,2.1,2,2.4,2.3,1.8,2.2,2.3,1.5,2.3,2,2,1.8,2.1,1.8,1.8,1.8,2.1,1.6,1.9,2,2.2,1.5,1.4,2.3,2.4,1.8,1.8,2.1,2.4,2.3,1.9,2.3,2.5,2.3,1.9,2,2.3,1.8],["setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sepal.Length<\/th>\n      <th>Sepal.Width<\/th>\n      <th>Petal.Length<\/th>\n      <th>Petal.Width<\/th>\n      <th>Species<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code># plot petal length vs width, species naive
ggplot(
  iris, aes(Petal.Length, Petal.Width)) +
  geom_point()</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code># plot petal length vs width, color by species
legend_pos &lt;- theme(
    legend.position = c(0.95, 0.05),
    legend.justification = c(&quot;right&quot;, &quot;bottom&quot;),
    legend.box.just = &quot;right&quot;)
ggplot(
  iris, aes(Petal.Length, Petal.Width, color = Species)) +
  geom_point() +
  legend_pos</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
</div>
<div id="cluster-iris-using-kmeans" class="section level3">
<h3>Cluster <code>iris</code> using <code>kmeans()</code></h3>
<pre class="r"><code># cluster using kmeans
k &lt;- 3  # number of clusters
iris_k &lt;- kmeans(
  iris %&gt;% 
    select(Petal.Length, Petal.Width), 
  centers = k)

# show cluster result
iris_k</code></pre>
<pre><code>## K-means clustering with 3 clusters of sizes 50, 52, 48
## 
## Cluster means:
##   Petal.Length Petal.Width
## 1     1.462000    0.246000
## 2     4.269231    1.342308
## 3     5.595833    2.037500
## 
## Clustering vector:
##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
##  [75] 2 2 2 3 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 2 3 3 3 3
## [112] 3 3 3 3 3 3 3 3 2 3 3 3 3 3 3 2 3 3 3 3 3 3 3 3 3 3 3 2 3 3 3 3 3 3 3 3 3
## [149] 3 3
## 
## Within cluster sum of squares by cluster:
## [1]  2.02200 13.05769 16.29167
##  (between_SS / total_SS =  94.3 %)
## 
## Available components:
## 
## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;     &quot;tot.withinss&quot;
## [6] &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;         &quot;ifault&quot;</code></pre>
<pre class="r"><code># compare clusters with species (which were not used to cluster)
table(iris_k$cluster, iris$Species)</code></pre>
<pre><code>##    
##     setosa versicolor virginica
##   1     50          0         0
##   2      0         48         4
##   3      0          2        46</code></pre>
<p><strong>Question</strong>: How many observations could be considered “misclassified” if expecting petal length and width to differentiate between species?</p>
<pre class="r"><code># extract cluster assignment per observation
Cluster = factor(iris_k$cluster)

ggplot(iris, aes(Petal.Length, Petal.Width, color = Cluster)) +
  geom_point() + 
  legend_pos</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="plot-voronoi-diagram-of-clustered-iris" class="section level3">
<h3>Plot Voronoi diagram of clustered <code>iris</code></h3>
<p>This form of clustering assigns points to the cluster based on nearest centroid. You can see the breaks more clearly with a <a href="https://en.wikipedia.org/wiki/Voronoi_diagram">Voronoi diagram</a>.</p>
<pre class="r"><code>librarian::shelf(ggvoronoi, scales)</code></pre>
<pre><code>## 
##   The &#39;cran_repo&#39; argument in shelf() was not set, so it will use
##   cran_repo = &#39;https://cran.r-project.org&#39; by default.
## 
##   To avoid this message, set the &#39;cran_repo&#39; argument to a CRAN
##   mirror URL (see https://cran.r-project.org/mirrors.html) or set
##   &#39;quiet = TRUE&#39;.</code></pre>
<pre class="r"><code># define bounding box for geom_voronoi()
box &lt;- tribble(
  ~Petal.Length, ~Petal.Width, ~group,
  1, 0.1, 1,
  1, 2.5, 1,
  7, 2.5, 1,
  7, 0.1, 1,
  1, 0.1, 1) %&gt;% 
  data.frame()

# cluster using kmeans
k &lt;- 3  # number of clusters
iris_k &lt;- kmeans(
  iris %&gt;% 
    select(Petal.Length, Petal.Width), 
  centers = k)

# extract cluster assignment per observation
Cluster = factor(iris_k$cluster)

# extract cluster centers
ctrs &lt;- as.data.frame(iris_k$centers) %&gt;% 
  mutate(
    Cluster = factor(1:k))

# plot points with voronoi diagram showing nearest centroid
ggplot(iris, aes(Petal.Length, Petal.Width, color = Cluster)) +
  geom_point() + 
  legend_pos +
  geom_voronoi(
    data = ctrs, aes(fill=Cluster), color = NA, alpha=0.5, outline = box) + 
  geom_point(
    data = ctrs, pch=23, cex=2, fill=&quot;black&quot;)</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p><strong>Task</strong>: Show the Voronoi diagram for fewer (<code>k=2</code>) and more (<code>k=8</code>) clusters to see how assignment to cluster centroids work.</p>
</div>
</div>
<div id="hierarchical-clustering" class="section level2">
<h2>Hierarchical Clustering</h2>
<p>Next, you’ll cluster sites according to species composition. You’ll use the <code>dune</code> dataset from the <code>vegan</code> R package.</p>
<div id="load-dune-dataset" class="section level3">
<h3>Load <code>dune</code> dataset</h3>
<pre class="r"><code>librarian::shelf(
  cluster, vegan)</code></pre>
<pre><code>## 
##   The &#39;cran_repo&#39; argument in shelf() was not set, so it will use
##   cran_repo = &#39;https://cran.r-project.org&#39; by default.
## 
##   To avoid this message, set the &#39;cran_repo&#39; argument to a CRAN
##   mirror URL (see https://cran.r-project.org/mirrors.html) or set
##   &#39;quiet = TRUE&#39;.</code></pre>
<pre class="r"><code># load dune dataset from package vegan
data(&quot;dune&quot;)

# show documentation on dataset if interactive
if (interactive())
  help(dune)</code></pre>
<p><strong>Question</strong>: What are the rows and columns composed of in the <code>dune</code> data frame?</p>
</div>
<div id="calculate-ecological-distances-on-sites" class="section level3">
<h3>Calculate Ecological Distances on <code>sites</code></h3>
<p>Before we calculate ecological distance between sites for <code>dune</code>, let’s look at these metrics with a simpler dataset, like the example given in Chapter 8 by <span class="citation">Kindt and Coe (2005)</span>.</p>
<pre class="r"><code>sites &lt;- tribble(
  ~site, ~sp1, ~sp2, ~sp3,
    &quot;A&quot;,    1,    1,    0,
    &quot;B&quot;,    5,    5,    0,
    &quot;C&quot;,    0,    0,    1) %&gt;% 
  column_to_rownames(&quot;site&quot;)
sites</code></pre>
<pre><code>##   sp1 sp2 sp3
## A   1   1   0
## B   5   5   0
## C   0   0   1</code></pre>
<pre class="r"><code>sites_manhattan &lt;- vegdist(sites, method=&quot;manhattan&quot;)
sites_manhattan</code></pre>
<pre><code>##    A  B
## B  8   
## C  3 11</code></pre>
<pre class="r"><code>sites_euclidean &lt;- vegdist(sites, method=&quot;euclidean&quot;)
sites_euclidean</code></pre>
<pre><code>##          A        B
## B 5.656854         
## C 1.732051 7.141428</code></pre>
<pre class="r"><code>sites_bray &lt;- vegdist(sites, method=&quot;bray&quot;)
sites_bray</code></pre>
<pre><code>##           A         B
## B 0.6666667          
## C 1.0000000 1.0000000</code></pre>
</div>
<div id="bray-curtis-dissimilarity-on-sites" class="section level3">
<h3>Bray-Curtis Dissimilarity on <code>sites</code></h3>
<p>Let’s take a closer look at the <a href="https://en.wikipedia.org/wiki/Bray%E2%80%93Curtis_dissimilarity">Bray-Curtis Dissimilarity</a> distance:</p>
<p><span class="math display">\[
B_{ij} = 1 - \frac{2C_{ij}}{S_i + S_j}
\]</span></p>
<ul>
<li><p><span class="math inline">\(B_{ij}\)</span>: Bray-Curtis dissimilarity value between sites <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.<br />
1 = completely dissimilar (no shared species); 0 = identical.</p></li>
<li><p><span class="math inline">\(C_{ij}\)</span>: sum of the lesser counts <span class="math inline">\(C\)</span> for shared species common to both sites <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span></p></li>
<li><p><span class="math inline">\(S_{i OR j}\)</span>: sum of all species counts <span class="math inline">\(S\)</span> for the given site <span class="math inline">\(i\)</span> or <span class="math inline">\(j\)</span></p></li>
</ul>
<p>So to calculate Bray-Curtis for the example <code>sites</code>:</p>
<ul>
<li><p><span class="math inline">\(B_{AB} = 1 - \frac{2 * (1 + 1)}{2 + 10} = 1 - 4/12 = 1 - 1/3 = 0.667\)</span></p></li>
<li><p><span class="math inline">\(B_{AC} = 1 - \frac{2 * 0}{2 + 1} = 1\)</span></p></li>
<li><p><span class="math inline">\(B_{BC} = 1 - \frac{2 * 0}{10 + 1} = 1\)</span></p></li>
</ul>
</div>
<div id="agglomerative-hierarchical-clustering-on-dune" class="section level3">
<h3>Agglomerative hierarchical clustering on <code>dune</code></h3>
<p>See text to accompany code: <em>HOMLR</em> <a href="https://bradleyboehmke.github.io/HOML/hierarchical.html#agglomerative-hierarchical-clustering">21.3.1 Agglomerative hierarchical clustering</a>.</p>
<pre class="r"><code># Dissimilarity matrix
d &lt;- vegdist(dune, method=&quot;bray&quot;)
dim(d)</code></pre>
<pre><code>## [1] 20 20</code></pre>
<pre class="r"><code>as.matrix(d)[1:5, 1:5]</code></pre>
<pre><code>##           1         2         3         4         5
## 1 0.0000000 0.4666667 0.4482759 0.5238095 0.6393443
## 2 0.4666667 0.0000000 0.3414634 0.3563218 0.4117647
## 3 0.4482759 0.3414634 0.0000000 0.2705882 0.4698795
## 4 0.5238095 0.3563218 0.2705882 0.0000000 0.5000000
## 5 0.6393443 0.4117647 0.4698795 0.5000000 0.0000000</code></pre>
<pre class="r"><code># Hierarchical clustering using Complete Linkage
hc1 &lt;- hclust(d, method = &quot;complete&quot; )

# Dendrogram plot of hc1
plot(hc1, cex = 0.6, hang = -1)</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># Compute agglomerative clustering with agnes
hc2 &lt;- agnes(dune, method = &quot;complete&quot;)

# Agglomerative coefficient
hc2$ac</code></pre>
<pre><code>## [1] 0.5398129</code></pre>
<pre class="r"><code># Dendrogram plot of hc2
plot(hc2, which.plot = 2)</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<pre class="r"><code># methods to assess
m &lt;- c( &quot;average&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;ward&quot;)
names(m) &lt;- c( &quot;average&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;ward&quot;)

# function to compute coefficient
ac &lt;- function(x) {
  agnes(dune, method = x)$ac
}

# get agglomerative coefficient for each linkage method
purrr::map_dbl(m, ac)</code></pre>
<pre><code>##   average    single  complete      ward 
## 0.4067153 0.2007896 0.5398129 0.6939994</code></pre>
<pre class="r"><code># Compute ward linkage clustering with agnes
hc3 &lt;- agnes(dune, method = &quot;ward&quot;)

# Agglomerative coefficient
hc3$ac</code></pre>
<pre><code>## [1] 0.6939994</code></pre>
<pre class="r"><code># Dendrogram plot of hc3
plot(hc3, which.plot = 2)</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
</div>
<div id="divisive-hierarchical-clustering-on-dune" class="section level3">
<h3>Divisive hierarchical clustering on <code>dune</code></h3>
<p>See text to accompany code: <em>HOMLR</em> <a href="https://bradleyboehmke.github.io/HOML/hierarchical.html#divisive-hierarchical-clustering">21.3.2 Divisive hierarchical clustering</a>.</p>
<pre class="r"><code># compute divisive hierarchical clustering
hc4 &lt;- diana(dune)

# Divise coefficient; amount of clustering structure found
hc4$dc</code></pre>
<pre><code>## [1] 0.5287677</code></pre>
</div>
<div id="determining-optimal-clusters" class="section level3">
<h3>Determining optimal clusters</h3>
<p>See text to accompany code: <em>HOMLR</em> <a href="https://bradleyboehmke.github.io/HOML/hierarchical.html#determining-optimal-clusters">21.4 Determining optimal clusters</a>.</p>
<pre class="r"><code>librarian::shelf(factoextra)</code></pre>
<pre><code>## 
##   The &#39;cran_repo&#39; argument in shelf() was not set, so it will use
##   cran_repo = &#39;https://cran.r-project.org&#39; by default.
## 
##   To avoid this message, set the &#39;cran_repo&#39; argument to a CRAN
##   mirror URL (see https://cran.r-project.org/mirrors.html) or set
##   &#39;quiet = TRUE&#39;.</code></pre>
<pre class="r"><code># Plot cluster results
p1 &lt;- fviz_nbclust(dune, FUN = hcut, method = &quot;wss&quot;,  k.max = 10) +
  ggtitle(&quot;(A) Elbow method&quot;)

p2 &lt;- fviz_nbclust(dune, FUN = hcut, method = &quot;silhouette&quot;, k.max = 10) +
  ggtitle(&quot;(B) Silhouette method&quot;)

p3 &lt;- fviz_nbclust(dune, FUN = hcut, method = &quot;gap_stat&quot;, k.max = 10) +
  ggtitle(&quot;(C) Gap statistic&quot;)

# Display plots side by side
gridExtra::grid.arrange(p1, p2, p3, nrow = 1)</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="working-with-dendrograms" class="section level3">
<h3>Working with dendrograms</h3>
<p>See text to accompany code: <em>HOMLR</em> <a href="https://bradleyboehmke.github.io/HOML/hierarchical.html#working-with-dendrograms">21.5 Working with dendrograms</a>.</p>
<pre class="r"><code># Construct dendorgram for the Ames housing example
hc5 &lt;- hclust(d, method = &quot;ward.D2&quot; )
dend_plot &lt;- fviz_dend(hc5)</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<pre class="r"><code>dend_data &lt;- attr(dend_plot, &quot;dendrogram&quot;)
dend_cuts &lt;- cut(dend_data, h = 8)
fviz_dend(dend_cuts$lower[[2]])</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code># Ward&#39;s method
hc5 &lt;- hclust(d, method = &quot;ward.D2&quot; )

# Cut tree into 4 groups
k = 4
sub_grp &lt;- cutree(hc5, k = k)

# Number of members in each cluster
table(sub_grp)</code></pre>
<pre><code>## sub_grp
## 1 2 3 4 
## 8 6 4 2</code></pre>
<pre class="r"><code># Plot full dendogram
fviz_dend(
  hc5,
  k = k,
  horiz = TRUE,
  rect = TRUE,
  rect_fill = TRUE,
  rect_border = &quot;jco&quot;,
  k_colors = &quot;jco&quot;)</code></pre>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =
## &quot;none&quot;)` instead.</code></pre>
<p><img src="lab2a_community-cluster_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-kindtTreeDiversityAnalysis2005" class="csl-entry">
Kindt, R., and Richard Coe. 2005. <em>Tree Diversity Analysis: A Manual and Software for Common Statistical Methods for Ecological and Biodiversity Studies</em>. <span>Nairobi, Kenya</span>: <span>World Agrofirestry Centre</span>.
</div>
</div>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
