<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
  <title>EDS 232: Lab 3. Reserve Design</title>



  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-09-26"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-09-26"/>
  <meta name="article:author" content="Jeffrey O. Hanson"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="EDS 232: Lab 3. Reserve Design"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="EDS 232"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="EDS 232: Lab 3. Reserve Design"/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Shortfalls and solutions for meeting national and global conservation area targets;citation_publication_date=2015;citation_volume=8;citation_author=Stuart H. M. Butchart;citation_author=Martin Clarke;citation_author=Robert J. Smith;citation_author=Rachel E. Sykes;citation_author=Jörn P. W. Scharlemann;citation_author=Mike Harfoot;citation_author=Graeme M. Buchanan;citation_author=Ariadne Angulo;citation_author=Andrew Balmford;citation_author=Bastian Bertzky;citation_author=Thomas M. Brooks;citation_author=Kent E. Carpenter;citation_author=Mia T. Comeros-Raynal;citation_author=John Cornell;citation_author=G. Francesco Ficetola;citation_author=Lincoln D. C. Fishpool;citation_author=Richard A. Fuller;citation_author=Jonas Geldmann;citation_author=Heather Harwell;citation_author=Craig Hilton-Taylor;citation_author=Michael Hoffmann;citation_author=Ackbar Joolia;citation_author=Lucas Joppa;citation_author=Naomi Kingston;citation_author=Ian May;citation_author=Amy Milam;citation_author=Beth Polidoro;citation_author=Gina Ralph;citation_author=Nadia Richman;citation_author=Carlo Rondinini;citation_author=Daniel B. Segan;citation_author=Benjamin Skolnik;citation_author=Mark D. Spalding;citation_author=Simon N. Stuart;citation_author=Andy Symes;citation_author=Joseph Taylor;citation_author=Piero Visconti;citation_author=James E. M. Watson;citation_author=Louisa Wood;citation_author=Neil D. Burgess"/>
  <meta name="citation_reference" content="citation_title=Global gap analysis: Priority regions for expanding the global protected-area network;citation_publication_date=2004;citation_volume=54;citation_author=Ana S. L. Rodrigues;citation_author=H. Resit Akçakaya;citation_author=Sandy J. Andelman;citation_author=Mohamed I. Bakarr;citation_author=Luigi Boitani;citation_author=Thomas M. Brooks;citation_author=Janice S. Chanson;citation_author=Lincoln D. C. Fishpool;citation_author=Gustavo A. B. Da Fonseca;citation_author=Kevin J. Gaston;citation_author=Michael Hoffmann;citation_author=Pablo A. Marquet;citation_author=John D. Pilgrim;citation_author=Robert L. Pressey;citation_author=Jan Schipper;citation_author=Wes Sechrest;citation_author=Simon N. Stuart;citation_author=Les G. Underhill;citation_author=Robert W. Waller;citation_author=Matthew E. J. Watts;citation_author=Xie Yan"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","date","output","bibliography","css","editor_options"]}},"value":[{"type":"character","attributes":{},"value":["Lab 3. Reserve Design"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Jeffrey O. Hanson"]}]}]},{"type":"character","attributes":{},"value":["2021-09-26"]},{"type":"character","attributes":{},"value":["html_document"]},{"type":"character","attributes":{},"value":["files/prioritizr.bib"]},{"type":"character","attributes":{},"value":["files/prioritizr-style.css"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["chunk_output_type"]}},"value":[{"type":"character","attributes":{},"value":["console"]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">strong {
    font-weight: 700; /* thicker than default bold */
  }


  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */

  /* Header font */
  @import url('https://fonts.googleapis.com/css2?family=Sanchez&display=swap');

  /* Body font */
  @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400&display=swap');

  /* Code font (Roboto Mono) */
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400&display=swap');

  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --title-weight:    400;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #003660;
    --title-weight:    400;
    --header-color:    rgba(4, 124, 145, 1);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    Sanchez;
    --mono-font:       Roboto Mono;
    --body-font:       Nunito Sans;
    --navbar-font:     Nunito Sans;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       20px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        18px;
    --hover-color:      white;
    --bkgd-color:       #047C91;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #003660;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */

  d-article h2 {
      grid-column: text;
      font-size: 32px;
      font-weight: 300;
      line-height: 1.1em;
      margin: 0 0 0.5rem;
      padding-top: 20px;
  }

  d-article h3 {
      grid-column: text;
      font-size: 24px;
      font-weight: 300;
      line-height: 1.1em;
      margin: 0 0 0.5rem;
  }

  a.title {
    font-style: bold;
  }

  a, .nav-dropdown .nav-dropbtn {
    font-weight: 500;
  }

  /* Set colors for headers */
  d-article h1, d-article h2, d-article h3, d-article h4, d-article h5, d-article h6 {
      color: rgba(4, 124, 145, 0.8);
  }

  /* Formatting tables (can update here or individually) */
  table, td, tr, th {
    border-collapse: collapse;
    font-family: Nunito Sans;
    border: 1px solid gainsboro;
    vertical-align: top;
  }

  d-article table th, d-article table td {
      font-size: 15px;
      padding: 2px 8px;
      border: 1px solid gainsboro;
  }

  /* Code style formatting of text */
  code {
    font-family: Roboto Mono;
  }

  .distill-site-header a, .distill-site-header .title {
      text-align: left;
      padding: 14px 14px 14px 14px;
  }

  d-title h1 {
      grid-column: text;
      font-size: 40px;
      font-weight: 400;
      line-height: 1.1em;
      margin: 0 0 0.5rem;
  }

  /* Update toc list font */
  .d-contents nav ul li {
      font-size: 20px;
  }

  /* Update overall layout (body width) */
  @media(min-width: 1180px) {
      .base-grid,
      distill-header,
      d-title,
      d-abstract,
      d-article,
      d-appendix,
      distill-appendix,
      d-byline,
      d-footnote-list,
      d-citation-list,
      distill-footer {
        grid-template-columns: [screen-start] 0.5fr [page-start kicker-start] 30px [middle-start] 50px [text-start kicker-end] 90px 90px 90px 90px 90px 90px 90px 90px [text-end gutter-start] 30px [middle-end] 50px [page-end gutter-end] 0.5fr [screen-end];
        grid-column-gap: 20px;
      }

  /* Change navbar dropdown menu bg color */
  .nav-dropdown-content a:hover {
      background-color: #003660;
      color: black;
  }
  </style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
  <link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
  <script src="site_libs/datatables-binding-0.19/datatables.js"></script>
  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
  <link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
  <script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
  <link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
  <script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="files/prioritizr-style.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Lab 3. Reserve Design","authors":[{"author":"Jeffrey O. Hanson","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-09-26T00:00:00.000-07:00","citationText":"Hanson, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">EDS 232</a>
</div>
<div class="nav-right">
<div class="nav-dropdown">
<button class="nav-dropbtn">
Labs
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="lab1a_sdm-explore.html">1a. Species: explore</a>
<a href="lab1b_sdm-regress.html">1b. Species: regress</a>
<a href="lab1c_sdm-trees.html">1c. Species: trees</a>
<a href="lab1d_sdm-evaluate.html">1d. Species: evaluate</a>
<a href="lab2a_community-cluster.html">2a. Community: cluster</a>
<a href="lab2b_community-ordination.html">2b. Community: ordination</a>
<a href="lab3_reserves.html">3. Conservation Planning</a>
<a href="review_midterm.html">Mid-Term Review</a>
</div>
</div>
<a href="glossary.html">Glosssary</a>
<a href="resources.html">Resources</a>
<a href="https://github.com/bbest/eds232-ml">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Lab 3. Reserve Design</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  
  Jeffrey O. Hanson
  
<br/>2021-09-26
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#overview"><span class="toc-section-number">1.1</span> Overview</a></li>
<li><a href="#r-packages"><span class="toc-section-number">1.2</span> R packages</a></li>
<li><a href="#data-setup"><span class="toc-section-number">1.3</span> Data Setup</a></li>
</ul></li>
<li><a href="#data"><span class="toc-section-number">2</span> Data</a>
<ul>
<li><a href="#data-import"><span class="toc-section-number">2.1</span> Data import</a></li>
<li><a href="#planning-unit-data"><span class="toc-section-number">2.2</span> Planning unit data</a></li>
<li><a href="#vegetation-data"><span class="toc-section-number">2.3</span> Vegetation data</a></li>
</ul></li>
<li><a href="#gap-analysis"><span class="toc-section-number">3</span> Gap analysis</a>
<ul>
<li><a href="#introduction-1"><span class="toc-section-number">3.1</span> Introduction</a></li>
<li><a href="#feature-abundance"><span class="toc-section-number">3.2</span> Feature abundance</a></li>
<li><a href="#feature-representation"><span class="toc-section-number">3.3</span> Feature representation</a></li>
</ul></li>
<li><a href="#spatial-prioritizations"><span class="toc-section-number">4</span> Spatial prioritizations</a>
<ul>
<li><a href="#introduction-2"><span class="toc-section-number">4.1</span> Introduction</a></li>
<li><a href="#starting-out-simple"><span class="toc-section-number">4.2</span> Starting out simple</a></li>
<li><a href="#adding-complexity"><span class="toc-section-number">4.3</span> Adding complexity</a></li>
<li><a href="#penalizing-fragmentation"><span class="toc-section-number">4.4</span> Penalizing fragmentation</a></li>
</ul></li>
<li><a href="#lab-3-submission"><span class="toc-section-number">5</span> Lab 3 Submission</a></li>
</ul>
</nav>
</div>
<h1 class="unnumbered" id="learning-objectives">Learning Objectives</h1>
<h1 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<p>This lab was created by the developer of the R package <a href="https://prioritizr.net/"><code>prioritizr</code></a> Jeffrey O. Hanson. I made slight tweaks to streamline code and reduce text.</p>
<p>You open this Rmarkdown document from taylor.bren.ucsb.edu at <code>/Courses/EDS232/eds232-ml/lab3_reserves.Rmd</code>, save to your home folder and respond to questions within the Rmarkdown document before knitting to complete the lab.</p>
<h2 data-number="1.1" id="overview"><span class="header-section-number">1.1</span> Overview</h2>
<p>The aim of this lab is to get you started with using the prioritizr R package for systematic conservation planning. It is not designed to give you a comprehensive overview and you will not become an expert after completing this workshop. Instead, we want to help you understand the core principles of conservation planning and guide you through some of the common tasks involved with developing prioritizations. In other words, we want to give you the knowledge base and confidence needed to start applying systematic conservation planning to your own work.</p>
<h2 data-number="1.2" id="r-packages"><span class="header-section-number">1.2</span> R packages</h2>
<p>An R package is a collection of R code and documentation that can be installed to enhance the standard R environment with additional functionality. Currently, there are over fifteen thousand R packages available on CRAN. Each of these R packages are developed to perform a specific task, such as <a href="https://cran.r-project.org/web/packages/readxl/index.html">reading Excel spreadsheets</a>, <a href="https://cran.r-project.org/web/packages/MODIStsp/index.html">downloading satellite imagery data</a>, <a href="https://cran.r-project.org/web/packages/wdpar/index.html">downloading and cleaning protected area data</a>, or <a href="https://cran.r-project.org/web/packages/ENMeval/index.html">fitting environmental niche models</a>. In fact, R has such a diverse ecosystem of R packages, that the question is almost always not “can I use R to …?” but “what R package can I use to …?” During this workshop, we will use several R packages. To install and load these R packages, please enter the code below in the <em>Console</em> part of the RStudio interface and press enter. Note that you will require an Internet connection and the installation process may take some time to complete.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/DesiQuintans/librarian'>"librarian"</a></span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/install.packages.html'>install.packages</a></span><span class='op'>(</span><span class='st'>"librarian"</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/DesiQuintans/librarian'>librarian</a></span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>librarian</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/librarian/man/shelf.html'>shelf</a></span><span class='op'>(</span>
  <span class='va'>assertthat</span>, <span class='va'>BiocManager</span>, <span class='va'>dplyr</span>, <span class='va'>gridExtra</span>, <span class='va'>here</span>, <span class='va'>mapview</span>, 
  <span class='va'>prioritizr</span>, <span class='va'>prioritizrdata</span>, 
  <span class='va'>raster</span>, <span class='va'>remotes</span>, <span class='va'>rgeos</span>, <span class='va'>rgdal</span>, <span class='va'>scales</span>, <span class='va'>sf</span>, <span class='va'>sp</span>, <span class='va'>stringr</span>,
  <span class='va'>units</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='st'><a href='http://R-Forge.R-project.org/projects/rsymphony'>"lpsymphony"</a></span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'>BiocManager</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/BiocManager/man/install.html'>install</a></span><span class='op'>(</span><span class='st'>"lpsymphony"</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://R-Forge.R-project.org/projects/rsymphony'>lpsymphony</a></span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h2 data-number="1.3" id="data-setup"><span class="header-section-number">1.3</span> Data Setup</h2>
<p>The data for this workshop are available online. The code chunk below handles downloading the data from <a href="https://github.com/prioritizr/massey-workshop/raw/main/data.zip">here</a>, saving it as <code>data.zip</code>, unzippig the <code>data.zip</code> file and moving files into <code>dir_data</code>. You should now have a new folder on your computer called <code>"data/prioritizr"</code> which contains the data files (e.g. <code>pu.shp</code> and <code>vegetation.tif</code>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dir_data</span> <span class='op'>&lt;-</span> <span class='fu'>here</span><span class='op'>(</span><span class='st'>"data/prioritizr"</span><span class='op'>)</span>
<span class='va'>pu_shp</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"pu.shp"</span><span class='op'>)</span>
<span class='va'>pu_url</span>   <span class='op'>&lt;-</span> <span class='st'>"https://github.com/prioritizr/massey-workshop/raw/main/data.zip"</span>
<span class='va'>pu_zip</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='fu'><a href='https://rdrr.io/r/base/basename.html'>basename</a></span><span class='op'>(</span><span class='va'>pu_url</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>vegetation_tif</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"vegetation.tif"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='va'>dir_data</span>, showWarnings <span class='op'>=</span> <span class='cn'>F</span>, recursive <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>pu_shp</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>pu_url</span>, <span class='va'>pu_zip</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/unzip.html'>unzip</a></span><span class='op'>(</span><span class='va'>pu_zip</span>, exdir <span class='op'>=</span> <span class='va'>dir_data</span><span class='op'>)</span>
  <span class='va'>dir_unzip</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"data"</span><span class='op'>)</span>
  <span class='va'>files_unzip</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span><span class='va'>dir_unzip</span>, full.names <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.rename</a></span><span class='op'>(</span>
    <span class='va'>files_unzip</span>, 
    <span class='va'>files_unzip</span> <span class='op'>%&gt;%</span> <span class='fu'>str_replace</span><span class='op'>(</span><span class='st'>"prioritizr/data"</span>, <span class='st'>"prioritizr"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pu_zip</span>, <span class='va'>dir_unzip</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h1 data-number="2" id="data"><span class="header-section-number">2</span> Data</h1>
<h2 data-number="2.1" id="data-import"><span class="header-section-number">2.1</span> Data import</h2>
<p>Now that we have the downloaded dataset, we will need to import it into our R session. Specifically, this data was obtained from the “Introduction to Marxan” course and was originally a subset of a larger spatial prioritization project performed under contract to Australia’s Department of Environment and Water Resources. It contains vector-based planning unit data (<code>pu.shp</code>) and the raster-based data describing the spatial distributions of 32 vegetation classes (<code>vegetation.tif</code>) in southern Tasmania, Australia. Please note this dataset is only provided for teaching purposes and should not be used for any real-world conservation planning. We can import the data into our R session using the following code.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># import planning unit data</span>
<span class='va'>pu_data</span> <span class='op'>&lt;-</span> <span class='fu'>as</span><span class='op'>(</span><span class='fu'>read_sf</span><span class='op'>(</span><span class='va'>pu_shp</span><span class='op'>)</span>, <span class='st'>"Spatial"</span><span class='op'>)</span>

<span class='co'># format columns in planning unit data</span>
<span class='va'>pu_data</span><span class='op'>$</span><span class='va'>locked_in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/logical.html'>as.logical</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>locked_in</span><span class='op'>)</span>
<span class='va'>pu_data</span><span class='op'>$</span><span class='va'>locked_out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/logical.html'>as.logical</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>locked_out</span><span class='op'>)</span>

<span class='co'># import vegetation data</span>
<span class='va'>veg_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/stack.html'>stack</a></span><span class='op'>(</span><span class='va'>vegetation_tif</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 data-number="2.2" id="planning-unit-data"><span class="header-section-number">2.2</span> Planning unit data</h2>
<p>The planning unit data contains spatial data describing the geometry for each planning unit and attribute data with information about each planning unit (e.g. cost values). Let’s investigate the <code>pu_data</code> object. The attribute data contains 5 columns with contain the following information:</p>
<ul>
<li><code>id</code>: unique identifiers for each planning unit</li>
<li><code>cost</code>: acquisition cost values for each planning unit (millions of Australian dollars).</li>
<li><code>status</code>: status information for each planning unit (only relevant with Marxan)</li>
<li><code>locked_in</code>: logical values (i.e. <code>TRUE</code>/<code>FALSE</code>) indicating if planning units are covered by protected areas or not.</li>
<li><code>locked_out</code>: logical values (i.e. <code>TRUE</code>/<code>FALSE</code>) indicating if planning units cannot be managed as a protected area because they contain are too degraded.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print a short summary of the data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class       : SpatialPolygonsDataFrame 
features    : 516 
extent      : 348703.2, 611932.4, 5167775, 5344516  (xmin, xmax, ymin, ymax)
crs         : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs 
variables   : 5
names       :   id,             cost, status, locked_in, locked_out 
min values  :  557, 3.59717531470679,      0,         0,          0 
max values  : 1130,  47.238336402701,      2,         1,          1 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot the planning unit data</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot an interactive map of the planning unit data</span>
<span class='fu'>mapview</span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the structure of object</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>pu_data</span>, max.level <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Formal class &#39;SpatialPolygonsDataFrame&#39; [package &quot;sp&quot;] with 5 slots
  ..@ data       :&#39;data.frame&#39;: 516 obs. of  5 variables:
  ..@ polygons   :List of 516
  ..@ plotOrder  : int [1:516] 69 104 1 122 157 190 4 221 17 140 ...
  ..@ bbox       : num [1:2, 1:2] 348703 5167775 611932 5344516
  .. ..- attr(*, &quot;dimnames&quot;)=List of 2
  ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
  ..$ comment: chr &quot;TRUE&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the class of the object</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;SpatialPolygonsDataFrame&quot;
attr(,&quot;package&quot;)
[1] &quot;sp&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the slots of the object</span>
<span class='fu'>slotNames</span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;data&quot;        &quot;polygons&quot;    &quot;plotOrder&quot;   &quot;bbox&quot;       
[5] &quot;proj4string&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the coordinate reference system</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>@</span><span class='va'>proj4string</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>CRS arguments:
 +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print number of planning units (geometries) in the data</span>
<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 516</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the first six rows in the data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>@</span><span class='va'>data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   id     cost status locked_in locked_out
1 557 29.74225      0     FALSE      FALSE
2 558 29.87703      0     FALSE      FALSE
3 574 28.60687      0     FALSE      FALSE
4 575 30.83416      0     FALSE      FALSE
5 576 38.75511      0     FALSE      FALSE
6 577 38.11618      2      TRUE      FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the first six values in the cost column of the attribute data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>cost</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 29.74225 29.87703 28.60687 30.83416 38.75511 38.11618</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the highest cost value</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>cost</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 47.23834</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the smallest cost value</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>cost</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 3.597175</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print average cost value</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>cost</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 26.87393</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot a map of the planning unit cost data</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='st'>"cost"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-9-1.png" width="60%" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot an interactive map of the planning unit cost data</span>
<span class='fu'>mapview</span><span class='op'>(</span><span class='va'>pu_data</span>, zcol <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, you can try and answer some questions about the planning unit data.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>How many planning units are in the planning unit data?</li>
<li>What is the highest cost value?</li>
<li>Is there a spatial pattern in the planning unit cost values (hint: use <code>plot</code> to make a map)?
</div></li>
</ol>
</div>
<h2 data-number="2.3" id="vegetation-data"><span class="header-section-number">2.3</span> Vegetation data</h2>
<p>The vegetation data describe the spatial distribution of 32 vegetation classes in the study area. This data is in a raster format and so the data are organized using a grid comprising square grid cells that are each the same size. In our case, the raster data contains multiple layers (also called “bands”) and each layer has corresponds to a spatial grid with exactly the same area and has exactly the same dimensionality (i.e. number of rows, columns, and cells). In this dataset, there are 32 different regular spatial grids layered on top of each other – with each layer corresponding to a different vegetation class – and each of these layers contains a grid with 164 rows, 326 columns, and 53464 cells. Within each layer, each cell corresponds to a 0.967 by 1.02 km square. The values associated with each grid cell indicate the (one) presence or (zero) absence of a given vegetation class in the cell.</p>
<p><img src="img/lab3_prioritizr/rasterbands.png" /></p>
<p>Let’s explore the vegetation data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print a short summary of the data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class      : RasterStack 
dimensions : 164, 326, 53464, 32  (nrow, ncol, ncell, nlayers)
resolution : 967, 1020  (x, y)
extent     : 298636.7, 613878.7, 5167756, 5335036  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs 
names      : vegetation.1, vegetation.2, vegetation.3, vegetation.4, vegetation.5, vegetation.6, vegetation.7, vegetation.8, vegetation.9, vegetation.10, vegetation.11, vegetation.12, vegetation.13, vegetation.14, vegetation.15, ... 
min values :            0,            0,            0,            0,            0,            0,            0,            0,            0,             0,             0,             0,             0,             0,             0, ... 
max values :            1,            1,            1,            1,            1,            1,            1,            1,            1,             1,             1,             1,             1,             1,             1, ... </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot a map of the 20th vegetation class</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>20</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/explore%20feature%20data-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot an interactive map of the 20th vegetation class</span>
<span class='fu'>mapview</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>20</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print number of rows in the data</span>
<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 164</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print number of columns  in the data</span>
<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 326</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print number of cells in the data</span>
<span class='fu'>ncell</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 53464</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print number of layers in the data</span>
<span class='fu'>nlayers</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 32</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print  resolution on the x-axis</span>
<span class='fu'>xres</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 967</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print resolution on the y-axis</span>
<span class='fu'>yres</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1020</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print spatial extent of the grid, i.e. coordinates for corners</span>
<span class='fu'>extent</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class      : Extent 
xmin       : 298636.7 
xmax       : 613878.7 
ymin       : 5167756 
ymax       : 5335036 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the coordinate reference system</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>@</span><span class='va'>crs</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>CRS arguments:
 +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print a summary of the first layer in the stack</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class      : RasterLayer 
band       : 1  (of  32  bands)
dimensions : 164, 326, 53464  (nrow, ncol, ncell)
resolution : 967, 1020  (x, y)
extent     : 298636.7, 613878.7, 5167756, 5335036  (xmin, xmax, ymin, ymax)
crs        : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs 
source     : vegetation.tif 
names      : vegetation.1 
values     : 0, 1  (min, max)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the value in the 800th cell in the first layer of the stack</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>800</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  
0 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print the value of the cell located in the 30th row and the 60th column of</span>
<span class='co'># the first layer</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>30</span>, <span class='fl'>60</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  
0 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate the sum of all the cell values in the first layer</span>
<span class='fu'>cellStats</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='st'>"sum"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 17</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate the maximum value of all the cell values in the first layer</span>
<span class='fu'>cellStats</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='st'>"max"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate the minimum value of all the cell values in the first layer</span>
<span class='fu'>cellStats</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='st'>"min"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate the mean value of all the cell values in the first layer</span>
<span class='fu'>cellStats</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='st'>"mean"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.00035239</code></pre>
</div>
<p>Now, you can try and answer some questions about the vegetation data.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>What part of the study area is the 13th vegetation class found in (hint: make a map)? For instance, is it in the south-eastern part of the study area?</li>
<li>What proportion of cells contain the 12th vegetation class? <em>Hint: You can use expressions inside <code>cellStats()</code> like <code>!is.na(veg_data[[1]])</code> and <code>veg_data[[1]] &gt; 0</code>.</em></li>
<li>Which vegetation class is the most abundant (i.e. present in the greatest number of cells)?
</div></li>
</ol>
</div>
<h1 data-number="3" id="gap-analysis"><span class="header-section-number">3</span> Gap analysis</h1>
<h2 data-number="3.1" id="introduction-1"><span class="header-section-number">3.1</span> Introduction</h2>
<p>Before we begin to prioritize areas for protected area establishment, we should first understand how well existing protected areas are conserving our biodiversity features (i.e. native vegetation classes in Tasmania, Australia). This step is critical: we cannot develop plans to improve conservation of biodiversity if we don’t understand how well existing policies are currently conserving biodiversity! To achieve this, we can perform a “gap analysis.” A gap analysis involves calculating how well each of our biodiversity features (i.e. vegetation classes in this exercise) are represented (covered) by protected areas. Next, we compare current representation by protected areas of each feature (e.g. 5% of their spatial distribution covered by protected areas) to a target threshold (e.g. 20% of their spatial distribution covered by protected areas). This target threshold denotes the minimum amount (e.g. minimum proportion of spatial distribution) that we need of each feature to be represented in the protected area system. Ideally, targets should be based on an estimate of how much area or habitat is needed for ecosystem function or species persistence. In practice, targets are generally set using simple rules of thumb (e.g. 10% or 20%), policy (17%; <a href="https://www.cbd.int/sp/targets/rationale/target-11" class="uri">https://www.cbd.int/sp/targets/rationale/target-11</a>) or standard practices (e.g. setting targets for species based on geographic range size) <span class="citation" data-cites="r1 r2">(<a href="#ref-r1" role="doc-biblioref">Butchart et al. 2015</a>; <a href="#ref-r2" role="doc-biblioref">Rodrigues et al. 2004</a>)</span>.</p>
<h2 data-number="3.2" id="feature-abundance"><span class="header-section-number">3.2</span> Feature abundance</h2>
<p>Now we will perform some preliminary calculations to explore the data. First, we will calculate how much of each vegetation feature occurs inside each planning unit (i.e. the abundance of the features). To achieve this, we will use the <code>problem</code> function to create an empty conservation planning problem that only contains the planning unit and biodiversity data. We will then use the <code>feature_abundances</code> function to calculate the total amount of each feature in each planning unit.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># create prioritizr problem with only the data</span>
<span class='va'>p0</span> <span class='op'>&lt;-</span> <span class='fu'>problem</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='va'>veg_data</span>, cost_column <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span>

<span class='co'># print empty problem,</span>
<span class='co'># we can see that only the cost and feature data are defined</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p0</span><span class='op'>)</span>

<span class='co'># calculate amount of each feature in each planning unit</span>
<span class='va'>abundance_data</span> <span class='op'>&lt;-</span> <span class='fu'>feature_abundances</span><span class='op'>(</span><span class='va'>p0</span><span class='op'>)</span>

<span class='co'># print abundance data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 × 3
   feature       absolute_abundance relative_abundance
   &lt;chr&gt;                      &lt;dbl&gt;              &lt;dbl&gt;
 1 vegetation.1                16.0                  1
 2 vegetation.2                14.3                  1
 3 vegetation.3                10.4                  1
 4 vegetation.4                17.8                  1
 5 vegetation.5                13.0                  1
 6 vegetation.6                14.3                  1
 7 vegetation.7                20.0                  1
 8 vegetation.8                14.0                  1
 9 vegetation.9                18.0                  1
10 vegetation.10               20.0                  1
# … with 22 more rows</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># note that only the first ten rows are printed,</span>
<span class='co'># this is because the abundance_data object is a tibble (i.e. tbl_df) object</span>
<span class='co'># and not a standard data.frame object</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># we can print all of the rows in abundance_data like this</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>abundance_data</span>, n <span class='op'>=</span> <span class='cn'>Inf</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 × 3
   feature       absolute_abundance relative_abundance
   &lt;chr&gt;                      &lt;dbl&gt;              &lt;dbl&gt;
 1 vegetation.1                16.0                  1
 2 vegetation.2                14.3                  1
 3 vegetation.3                10.4                  1
 4 vegetation.4                17.8                  1
 5 vegetation.5                13.0                  1
 6 vegetation.6                14.3                  1
 7 vegetation.7                20.0                  1
 8 vegetation.8                14.0                  1
 9 vegetation.9                18.0                  1
10 vegetation.10               20.0                  1
11 vegetation.11               23.6                  1
12 vegetation.12              748.                   1
13 vegetation.13              126.                   1
14 vegetation.14               10.5                  1
15 vegetation.15               17.5                  1
16 vegetation.16               15.0                  1
17 vegetation.17              213.                   1
18 vegetation.18               14.3                  1
19 vegetation.19               17.1                  1
20 vegetation.20               21.4                  1
21 vegetation.21               18.6                  1
22 vegetation.22              297.                   1
23 vegetation.23               20.3                  1
24 vegetation.24              165.                   1
25 vegetation.25              716.                   1
26 vegetation.26               24.0                  1
27 vegetation.27               18.8                  1
28 vegetation.28               17.5                  1
29 vegetation.29               24.7                  1
30 vegetation.30               59.0                  1
31 vegetation.31               60.0                  1
32 vegetation.32               32                    1</code></pre>
</div>
<p>The <code>abundance_data</code> object contains three columns. The <code>feature</code> column contains the name of each feature (derived from <code>names(veg_data)</code>), the <code>absolute_abundance</code> column contains the total amount of each feature in all the planning units, and the <code>relative_abundance</code> column contains the total amount of each feature in the planning units expressed as a proportion of the total amount in the underlying raster data. Since all the raster cells containing vegetation overlap with the planning units, all of the values in the <code>relative_abundance</code> column are equal to one (meaning 100%). <em>So the <code>relative_abundance</code> per <code>feature</code> is a measure of the ‘percent presence’ of that feature across all planning units (100% or 1 in the case of all these vegetation layers, which is not interesting), whereas <code>absolute_abundance</code> measures the total amount of that feature when the value for all planning units is added up.</em> Now let’s add a new column with the feature abundances expressed in area units (i.e. km<sup>2</sup>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># add new column with feature abundances in km^2</span>
<span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>absolute_abundance_km2</span> <span class='op'>&lt;-</span>
  <span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>absolute_abundance</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/prod.html'>prod</a></span><span class='op'>(</span><span class='fu'>res</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_units</span><span class='op'>(</span><span class='va'>m</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_units</span><span class='op'>(</span><span class='va'>km</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>

<span class='co'># print abundance data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 × 4
   feature       absolute_abundance relative_abundan… absolute_abunda…
   &lt;chr&gt;                      &lt;dbl&gt;             &lt;dbl&gt;           [km^2]
 1 vegetation.1                16.0                 1             15.8
 2 vegetation.2                14.3                 1             14.1
 3 vegetation.3                10.4                 1             10.2
 4 vegetation.4                17.8                 1             17.6
 5 vegetation.5                13.0                 1             12.8
 6 vegetation.6                14.3                 1             14.1
 7 vegetation.7                20.0                 1             19.7
 8 vegetation.8                14.0                 1             13.9
 9 vegetation.9                18.0                 1             17.8
10 vegetation.10               20.0                 1             19.7
# … with 22 more rows</code></pre>
</div>
<p>Now let’s explore the abundance data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate the average abundance of the features</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>absolute_abundance_km2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>86.82948 [km^2]</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot histogram of the features' abundances</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>absolute_abundance_km2</span>, main <span class='op'>=</span> <span class='st'>"Feature abundances"</span><span class='op'>)</span>
</code></pre>
</div>
<img src="lab3_reserves_files/figure-html5/unnamed-chunk-18-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># find the abundance of the feature with the largest abundance</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>absolute_abundance_km2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>737.982 [km^2]</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># find the name of the feature with the largest abundance</span>
<span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>feature</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>abundance_data</span><span class='op'>$</span><span class='va'>absolute_abundance_km2</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;vegetation.12&quot;</code></pre>
</div>
<p>Now, try to answer the following questions.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>What is the median abundance of the features (hint: <code>median</code>)?</li>
<li>What is the name of the feature with smallest abundance?</li>
<li>How many features have a total abundance greater than 100 km^2 (hint: use <code>sum(abundance_data$absolute_abundance_km2 &gt; set_units(threshold, km^2)</code> with the correct <code>threshold</code> value)?</li>
</ol>
</div>
</div>
<h2 data-number="3.3" id="feature-representation"><span class="header-section-number">3.3</span> Feature representation</h2>
<p>After calculating the total amount of each feature in the planning units (i.e. the features’ abundances), we will now calculate the amount of each feature in the planning units that are covered by protected areas (i.e. feature representation by protected areas). We can complete this task using the <code>eval_feature_representation_summary()</code> function. This function requires (i) a conservation problem object with the planning unit and biodiversity data and also (ii) an object representing a solution to the problem (i.e an object in the same format as the planning unit data with values indicating if the planning units are selected or not).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># create column in planning unit data with binary values (zeros and ones)</span>
<span class='co'># indicating if a planning unit is covered by protected areas or not</span>
<span class='va'>pu_data</span><span class='op'>$</span><span class='va'>pa_status</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>$</span><span class='va'>locked_in</span><span class='op'>)</span>

<span class='co'># calculate feature representation by protected areas</span>
<span class='va'>repr_data</span> <span class='op'>&lt;-</span> <span class='fu'>eval_feature_representation_summary</span><span class='op'>(</span><span class='va'>p0</span>, <span class='va'>pu_data</span><span class='op'>[</span>, <span class='st'>"pa_status"</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'># print feature representation data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>repr_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 × 5
   summary feature       total_amount absolute_held relative_held
   &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 overall vegetation.1          16.0         0            0     
 2 overall vegetation.2          14.3         0            0     
 3 overall vegetation.3          10.4         0            0     
 4 overall vegetation.4          17.8         0            0     
 5 overall vegetation.5          13.0         0            0     
 6 overall vegetation.6          14.3         0            0     
 7 overall vegetation.7          20.0         0            0     
 8 overall vegetation.8          14.0         0            0     
 9 overall vegetation.9          18.0         0.846        0.0470
10 overall vegetation.10         20.0         0            0     
# … with 22 more rows</code></pre>
</div>
<p>Similar to the abundance data before, the <code>repr_data</code> object contains three columns. The <code>feature</code> column contains the name of each feature, the <code>absolute_held</code> column shows the total amount of each feature held in the solution (i.e. the planning units covered by protected areas), and the <code>relative_held</code> column shows the proportion of each feature held in the solution (i.e. the proportion of each feature’s spatial distribution held in protected areas). <em>So the <code>absolute_held</code> is an amount up to but not exceeding the original <code>absolute_abundance</code> of that feature across all planning units (see above) based on those planning units in the solution, and the <code>relative_held</code> is like the percent of planning units in the solution that had this feature present.</em> Since the <code>absolute_held</code> values correspond to the number of grid cells in the <code>veg_data</code> object with overlap with protected areas, let’s convert them to area units (i.e. km<sup>2</sup>) so we can report them.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># add new column with the areas represented in km^2</span>
<span class='va'>repr_data</span><span class='op'>$</span><span class='va'>absolute_held_km2</span> <span class='op'>&lt;-</span>
  <span class='op'>(</span><span class='va'>repr_data</span><span class='op'>$</span><span class='va'>absolute_held</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/prod.html'>prod</a></span><span class='op'>(</span><span class='fu'>res</span><span class='op'>(</span><span class='va'>veg_data</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_units</span><span class='op'>(</span><span class='va'>m</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_units</span><span class='op'>(</span><span class='va'>km</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>

<span class='co'># print representation data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>repr_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 × 6
   summary feature       total_amount absolute_held relative_held
   &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 overall vegetation.1          16.0         0            0     
 2 overall vegetation.2          14.3         0            0     
 3 overall vegetation.3          10.4         0            0     
 4 overall vegetation.4          17.8         0            0     
 5 overall vegetation.5          13.0         0            0     
 6 overall vegetation.6          14.3         0            0     
 7 overall vegetation.7          20.0         0            0     
 8 overall vegetation.8          14.0         0            0     
 9 overall vegetation.9          18.0         0.846        0.0470
10 overall vegetation.10         20.0         0            0     
# … with 22 more rows, and 1 more variable: absolute_held_km2 [km^2]</code></pre>
</div>
<p>Now let’s investigate how well the species are represented.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>What is the average proportion of the features held in protected areas (hint: use <code>mean(table$relative_held)</code> with the correct <code>table</code> name)?</li>
<li>If we set a target of 10% coverage by protected areas, how many features fail to meet this target (hint: use <code>sum(table$relative_held &lt; target_value)</code> [OLD typo: <code>sum(table$relative_held &gt;= target_value)</code>] with the correct <code>table</code> name)?</li>
<li>If we set a target of 20% coverage by protected areas, how many features fail to meet this target?</li>
<li>Is there a relationship between the total abundance of a feature and how well it is represented by protected areas (hint: <code>plot(abundance_data$absolute_abundance ~ repr_data$relative_held)</code>)?</li>
</ol>
</div>
</div>
<h1 data-number="4" id="spatial-prioritizations"><span class="header-section-number">4</span> Spatial prioritizations</h1>
<h2 data-number="4.1" id="introduction-2"><span class="header-section-number">4.1</span> Introduction</h2>
<p>Here we will develop prioritizations to identify priority areas for protected area establishment. Its worth noting that prioritizr is a decision support tool (similar to <a href="http://marxan.org/">Marxan</a> and <a href="https://www.helsinki.fi/en/researchgroups/digital-geography-lab/software-developed-in-cbig#section-52992">Zonation</a>). This means that it is designed to help you make decisions—it can’t make decisions for you.</p>
<h2 data-number="4.2" id="starting-out-simple"><span class="header-section-number">4.2</span> Starting out simple</h2>
<p>To start things off, let’s keep things simple. Let’s create a prioritization using the <a href="https://prioritizr.net/reference/add_min_set_objective.html">minimum set formulation of the reserve selection problem</a>. This formulation means that we want a solution that will meet the targets for our biodiversity features for minimum cost. Here, we will set 5% targets for each vegetation class and use the data in the <code>cost</code> column to specify acquisition costs. Although we strongly recommend using <a href="https://www.gurobi.com/">Gurobi</a> to solve problems (with <a href="https://prioritizr.net/reference/add_gurobi_solver.html"><code>add_gurobi_solver</code></a>), we will use the <a href="https://prioritizr.net/reference/add_lpsymphony_solver.html">lpsymphony solver</a> in this workshop since it is easier to install. The Gurobi solver is much faster than the lpsymphony solver (<a href="https://prioritizr.net/articles/gurobi_installation.html">see here for installation instructions</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print planning unit data</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>pu_data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class       : SpatialPolygonsDataFrame 
features    : 516 
extent      : 348703.2, 611932.4, 5167775, 5344516  (xmin, xmax, ymin, ymax)
crs         : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs 
variables   : 6
names       :   id,             cost, status, locked_in, locked_out, pa_status 
min values  :  557, 3.59717531470679,      0,         0,          0,         0 
max values  : 1130,  47.238336402701,      2,         1,          1,         1 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># make prioritization problem</span>
<span class='va'>p1_rds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"p1.rds"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>p1_rds</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'>problem</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='va'>veg_data</span>, cost_column <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'>add_min_set_objective</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'>add_relative_targets</span><span class='op'>(</span><span class='fl'>0.05</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># 5% representation targets</span>
        <span class='fu'>add_binary_decisions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'>add_lpsymphony_solver</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p1_rds</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>p1_rds</span><span class='op'>)</span>

<span class='co'># print problem</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p1</span><span class='op'>)</span>

<span class='co'># solve problem</span>
<span class='va'>s1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>p1</span><span class='op'>)</span>

<span class='co'># print solution, the solution_1 column contains the solution values</span>
<span class='co'># indicating if a planning unit is (1) selected or (0) not</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>s1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class       : SpatialPolygonsDataFrame 
features    : 516 
extent      : 348703.2, 611932.4, 5167775, 5344516  (xmin, xmax, ymin, ymax)
crs         : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs 
variables   : 7
names       :   id,             cost, status, locked_in, locked_out, pa_status, solution_1 
min values  :  557, 3.59717531470679,      0,         0,          0,         0,          0 
max values  : 1130,  47.238336402701,      2,         1,          1,         1,          1 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate number of planning units selected in the prioritization</span>
<span class='fu'>eval_n_summary</span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>s1</span><span class='op'>[</span>, <span class='st'>"solution_1"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 × 2
  summary  cost
  &lt;chr&gt;   &lt;dbl&gt;
1 overall    15</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate total cost of the prioritization</span>
<span class='fu'>eval_cost_summary</span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>s1</span><span class='op'>[</span>, <span class='st'>"solution_1"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 × 2
  summary  cost
  &lt;chr&gt;   &lt;dbl&gt;
1 overall  385.</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot solution</span>
<span class='co'># selected = green, not selected = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>s1</span>, <span class='st'>"solution_1"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkgreen"</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"s1"</span>,
       colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-23-1.png" width="65%" /></p>
</div>
<p>Now let’s examine the solution.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>How many planing units were selected in the prioritization? What proportion of planning units were selected in the prioritization?</li>
<li>Is there a pattern in the spatial distribution of the priority areas?</li>
<li>Can you verify that all of the targets were met in the prioritization (hint: <code>eval_feature_representation_summary(p1, s1[, "solution_1"])</code>)?</li>
</ol>
</div>
</div>
<h2 data-number="4.3" id="adding-complexity"><span class="header-section-number">4.3</span> Adding complexity</h2>
<p>Our first prioritization suffers many limitations, so let’s add additional constraints to the problem to make it more useful. First, let’s lock in planing units that are already by covered protected areas. If some vegetation communities are already secured inside existing protected areas, then we might not need to add as many new protected areas to the existing protected area system to meet their targets. Since our planning unit data (<code>pu_da</code>) already contains this information in the <code>locked_in</code> column, we can use this column name to specify which planning units should be locked in.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot locked_in data</span>
<span class='co'># TRUE = blue, FALSE = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='st'>"locked_in"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkblue"</span><span class='op'>)</span>,
       main <span class='op'>=</span> <span class='st'>"locked_in"</span>, colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-25-1.png" width="65%" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># make prioritization problem</span>
<span class='va'>p2_rds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"p2.rds"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>p2_rds</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'>problem</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='va'>veg_data</span>, cost_column <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>add_min_set_objective</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>add_relative_targets</span><span class='op'>(</span><span class='fl'>0.05</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>add_locked_in_constraints</span><span class='op'>(</span><span class='st'>"locked_in"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>add_binary_decisions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>add_lpsymphony_solver</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>p2</span>, <span class='va'>p2_rds</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>p2_rds</span><span class='op'>)</span>

<span class='co'># print problem</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span>

<span class='co'># solve problem</span>
<span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span>

<span class='co'># plot solution</span>
<span class='co'># selected = green, not selected = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>s2</span>, <span class='st'>"solution_1"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkgreen"</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"s2"</span>,
       colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-26-1.png" width="65%" /></p>
</div>
<p>Let’s pretend that we talked to an expert on the vegetation communities in our study system and they recommended that a 10% target was needed for each vegetation class. So, equipped with this information, let’s set the targets to 10%.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># make prioritization problem</span>
<span class='va'>p3_rds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"p3.rds"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>p3_rds</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'>problem</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='va'>veg_data</span>, cost_column <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_min_set_objective</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_relative_targets</span><span class='op'>(</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_locked_in_constraints</span><span class='op'>(</span><span class='st'>"locked_in"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_binary_decisions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_lpsymphony_solver</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>p3</span>, <span class='va'>p3_rds</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>p3_rds</span><span class='op'>)</span>

<span class='co'># print problem</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p3</span><span class='op'>)</span>

<span class='co'># solve problem</span>
<span class='va'>s3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>p3</span><span class='op'>)</span>

<span class='co'># plot solution</span>
<span class='co'># selected = green, not selected = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>s3</span>, <span class='st'>"solution_1"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkgreen"</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"s3"</span>,
       colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-27-1.png" width="65%" /></p>
</div>
<p>Next, let’s lock out highly degraded areas. Similar to before, this information is present in our planning unit data so we can use the <code>locked_out</code> column name to achieve this.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot locked_out data</span>
<span class='co'># TRUE = red, FALSE = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='st'>"locked_out"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkred"</span><span class='op'>)</span>,
       main <span class='op'>=</span> <span class='st'>"locked_out"</span>, colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<img src="lab3_reserves_files/figure-html5/unnamed-chunk-28-1.png" width="65%" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># make prioritization problem</span>
<span class='va'>p4_rds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"p4.rds"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>p4_rds</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'>problem</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='va'>veg_data</span>, cost_column <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_min_set_objective</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_relative_targets</span><span class='op'>(</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_locked_in_constraints</span><span class='op'>(</span><span class='st'>"locked_in"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_locked_out_constraints</span><span class='op'>(</span><span class='st'>"locked_out"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_binary_decisions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_lpsymphony_solver</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>p4</span>, <span class='va'>p4_rds</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>p4_rds</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># print problem</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p4</span><span class='op'>)</span>

<span class='co'># solve problem</span>
<span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>p4</span><span class='op'>)</span>

<span class='co'># plot solution</span>
<span class='co'># selected = green, not selected = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>s4</span>, <span class='st'>"solution_1"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkgreen"</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"s4"</span>,
       colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-29-1.png" width="65%" /></p>
</div>
<p>Now, let’s compare the solutions.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>What is the cost of the planning units selected in <code>s2</code>, <code>s3</code>, and <code>s4</code>?</li>
<li>How many planning units are in <code>s2</code>, <code>s3</code>, and <code>s4</code>?</li>
<li>Do the solutions with more planning units have a greater cost? Why (or why not)?</li>
<li>Why does the first solution (<code>s1</code>) cost less than the second solution with protected areas locked into the solution (<code>s2</code>)?</li>
<li>Why does the third solution (<code>s3</code>) cost less than the fourth solution solution with highly degraded areas locked out (<code>s4</code>)?
</div></li>
</ol>
</div>
<h2 data-number="4.4" id="penalizing-fragmentation"><span class="header-section-number">4.4</span> Penalizing fragmentation</h2>
<p>Plans for protected area systems should promote connectivity. However, the prioritizations we have made so far have been highly fragmented. To address this issue, we can add penalties to our conservation planning problem to penalize fragmentation. These penalties work by specifying a trade-off between the primary objective (here, solution cost) and fragmentation (i.e. total exposed boundary length) using a penalty value. If we set the penalty value too low, then we will end up with a solution that is nearly identical to the previous solution. If we set the penalty value too high, then prioritizr will (1) take a long time to solve the problem and (2) we will end up with a solution that contains lots of extra planning units that are not needed. This is because the minimizing fragmentation is considered so much more important than solution cost that the optimal solution is simply to select as many planning units as possible.</p>
<p>As a rule of thumb, we generally want penalty values between 0.00001 and 0.01. However, finding a useful penalty value requires calibration. The “correct” penalty value depends on the size of the planning units, the main objective values (e.g. cost values), and the effect of fragmentation on biodiversity persistence. Let’s create a new problem that is similar to our previous problem (<code>p4</code>)—except that it contains boundary length penalties—and solve it. Since our planning unit data is in a spatial format (i.e. vector or raster data), prioritizr can automatically calculate the boundary data for us.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># make prioritization problem</span>
<span class='va'>p5_rds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>dir_data</span>, <span class='st'>"p5.rds"</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>p5_rds</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'>problem</span><span class='op'>(</span><span class='va'>pu_data</span>, <span class='va'>veg_data</span>, cost_column <span class='op'>=</span> <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_min_set_objective</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_boundary_penalties</span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fl'>0.001</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_relative_targets</span><span class='op'>(</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_locked_in_constraints</span><span class='op'>(</span><span class='st'>"locked_in"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_locked_out_constraints</span><span class='op'>(</span><span class='st'>"locked_out"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_binary_decisions</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>add_lpsymphony_solver</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>p5</span>, <span class='va'>p5_rds</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>p5_rds</span><span class='op'>)</span>

<span class='co'># print problem</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span>

<span class='co'># solve problem,</span>
<span class='co'># note this will take a bit longer than the previous runs</span>
<span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span>

<span class='co'># print solution</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>s5</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>class       : SpatialPolygonsDataFrame 
features    : 516 
extent      : 348703.2, 611932.4, 5167775, 5344516  (xmin, xmax, ymin, ymax)
crs         : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs 
variables   : 7
names       :   id,             cost, status, locked_in, locked_out, pa_status, solution_1 
min values  :  557, 3.59717531470679,      0,         0,          0,         0,          0 
max values  : 1130,  47.238336402701,      2,         1,          1,         1,          1 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot solution</span>
<span class='co'># selected = green, not selected = grey</span>
<span class='fu'>spplot</span><span class='op'>(</span><span class='va'>s5</span>, <span class='st'>"solution_1"</span>, col.regions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"grey80"</span>, <span class='st'>"darkgreen"</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"s5"</span>,
       colorkey <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lab3_reserves_files/figure-html5/unnamed-chunk-32-1.png" width="65%" /></p>
</div>
<p>Now let’s compare the solutions to the problems with (<code>s5</code>) and without (<code>s4</code>) the boundary length penalties.</p>
<div class="layout-chunk" data-layout="l-body">

<div class="rmdquestion">
<ol type="1">
<li>What is the cost the fourth (<code>s4</code>) and fifth (<code>s5</code>) solutions? Why does the fifth solution (<code>s5</code>) cost more than the fourth (<code>s4</code>) solution?</li>
<li>Try setting the penalty value to 0.000000001 (i.e. <code>1e-9</code>) instead of 0.001. What is the cost of the solution now? Is it different from the fourth solution (<code>s4</code>) (hint: try plotting the solutions to visualize them)? Is this is a useful penalty value? Why (or why not)?</li>
<li>Try setting the penalty value to 0.5. What is the cost of the solution now? Is it different from the fourth solution (<code>s4</code>) (hint: try plotting the solutions to visualize them)? Is this a useful penalty value? Why (or why not)?
</div></li>
</ol>
</div>
<h1 data-number="5" id="lab-3-submission"><span class="header-section-number">5</span> Lab 3 Submission</h1>
<p>To submit Lab 3, please submit the path on <code>taylor.bren.ucsb.edu</code> to your single consolidated Rmarkdown document (i.e. combined from separate parts) that you successfully knitted here:</p>
<ul>
<li><a href="https://forms.gle/AhsXwMpUBLwXkFHRA" target="_blank">Submit Lab 3. Reserves</a></li>
</ul>
<p>The path should start <code>/Users/</code> and end in <code>.Rmd</code>. Please be sure to have succesfully knitted to html, as in I should see the <code>.html</code> file there by the same name with all the outputs.</p>
<p>In your lab, please be sure to include all outputs from running the lab and any tweaks needed to respond to the following questions:</p>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-99031458b7c76cf87979" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-99031458b7c76cf87979">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],["Planning unit data","Planning unit data","Planning unit data","Vegetation data","Vegetation data","Vegetation data","Feature abundance","Feature abundance","Feature abundance","Feature representation","Feature representation","Feature representation","Feature representation","Starting out simple","Starting out simple","Starting out simple","Adding complexity","Adding complexity","Adding complexity","Adding complexity","Adding complexity","Penalizing fragmentation","Penalizing fragmentation","Penalizing fragmentation"],["How many planning units are in the planning unit data?","What is the highest cost value?","Is there a spatial pattern in the planning unit cost values (hint: use <code>plot<\/code> to make a map)?","What part of the study area is the 13th vegetation class found in (hint: make a map)? For instance, is it in the south-eastern part of the study area?","What proportion of cells contain the 12th vegetation class? <em>Hint: You can use expressions inside <code>cellStats()<\/code> like <code>!is.na(veg_data[[1]])<\/code> and <code>veg_data[[1]] &gt; 0<\/code>.<\/em>","Which vegetation class is the most abundant (i.e. present in the greatest number of cells)?","What is the median abundance of the features (hint: median)?","What is the name of the feature with smallest abundance?","How many features have a total abundance greater than 100 km<sup>2<\/sup> (hint: use <code>sum(abundance_data$absolute_abundance_km2 &gt; set_units(threshold, km^2)<\/code> with the correct <code>threshold<\/code> value)?","What is the average proportion of the features held in protected areas (hint: use <code>mean(table$relative_held)<\/code> with the correct <code>table<\/code> name)?","If we set a target of 10% coverage by protected areas, how many features fail to meet this target (hint: use <code>sum(table$relative_held &lt; target_value)<\/code> [OLD typo: <code>sum(table$relative_held &gt;= target_value)<\/code>]  with the correct <code>table<\/code> name)?","If we set a target of 20% coverage by protected areas, how many features fail to meet this target?","Is there a relationship between the total abundance of a feature and how well it is represented by protected areas (hint: <code>plot(abundance_data$absolute_abundance ~ repr_data$relative_held)<\/code>)?","How many planing units were selected in the prioritization? What proportion of planning units were selected in the prioritization?","Is there a pattern in the spatial distribution of the priority areas?","Can you verify that all of the targets were met in the prioritization (hint: <code>eval_feature_representation_summary(p1, s1[, &quot;solution_1&quot;])<\/code>)?","What is the cost of the planning units selected in <code>s2<\/code>, <code>s3<\/code>, and <code>s4<\/code>?","How many planning units are in <code>s2<\/code>, <code>s3<\/code>, and <code>s4<\/code>?","Do the solutions with more planning units have a greater cost? Why (or why not)?","Why does the first solution (<code>s1<\/code>) cost less than the second solution with protected areas locked into the solution (<code>s2<\/code>)?","Why does the third solution (<code>s3<\/code>) cost less than the fourth solution solution with highly degraded areas locked out (<code>s4<\/code>)?","What is the cost the fourth (<code>s4<\/code>) and fifth (<code>s5<\/code>) solutions? Why does the fifth solution (<code>s5<\/code>) cost more than the fourth (<code>s4<\/code>) solution?","Try setting the penalty value to 0.000000001 (i.e. <code>1e-9<\/code>) instead of 0.001. What is the cost of the solution now? Is it different from the fourth solution (<code>s4<\/code>) (hint: try plotting the solutions to visualize them)? Is this is a useful penalty value? Why (or why not)?","Try setting the penalty value to 0.5. What is the cost of the solution now? Is it different from the fourth solution (<code>s4<\/code>) (hint: try plotting the solutions to visualize them)? Is this a useful penalty value? Why (or why not)?"],[0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.6,0.6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>#<\/th>\n      <th>Lab<\/th>\n      <th>Item<\/th>\n      <th>Pts<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,3]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-r1" class="csl-entry" role="doc-biblioentry">
Butchart, Stuart H. M., Martin Clarke, Robert J. Smith, Rachel E. Sykes, Jörn P. W. Scharlemann, Mike Harfoot, Graeme M. Buchanan, et al. 2015. <span>“Shortfalls and Solutions for Meeting National and Global Conservation Area Targets.”</span> <em>Conservation Letters</em> 8 (5): 329–37.
</div>
<div id="ref-r2" class="csl-entry" role="doc-biblioentry">
Rodrigues, Ana S. L., H. Resit Akçakaya, Sandy J. Andelman, Mohamed I. Bakarr, Luigi Boitani, Thomas M. Brooks, Janice S. Chanson, et al. 2004. <span>“Global Gap Analysis: Priority Regions for Expanding the Global Protected-Area Network.”</span> <em>BioScience</em> 54 (12): 1092–1100.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>
<a href="https://bren.ucsb.edu/"><img src="img/bren_white_logo.png" alt="Bren School logo" style="width:350px;" /></a>
</p>
<p>
  This website was made with <u><a href="https://rstudio.github.io/distill/">distill by RStudio</a></u>.
</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
